<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Predictive Maintenance Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 500;
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }

        .status.info {
            background: #bee3f8;
            color: #2a4365;
            border: 1px solid #90cdf4;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            max-height: 300px;
            overflow-y: auto;
        }

        .result pre {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .file-upload {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #667eea;
        }

        .file-upload.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-weight: 600;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .health-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .health-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #48bb78;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f7fafc;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Enhanced Chat UI Styles */
        .chat-answer-container {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .chat-answer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .chat-answer-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .confidence-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .confidence-high {
            background: #c6f6d5;
            color: #22543d;
        }

        .confidence-medium {
            background: #fefcbf;
            color: #744210;
        }

        .confidence-low {
            background: #fed7d7;
            color: #742a2a;
        }

        .chat-answer-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #2d3748;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid #48bb78;
        }

        .chat-sources-container {
            margin-top: 20px;
        }

        .chat-sources-header {
            font-size: 1rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Compact Citation Styles */
        .source-citations {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .source-citation {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 15px;
            background: #f7fafc;
            border-radius: 6px;
            border-left: 3px solid #667eea;
            transition: all 0.2s ease;
        }

        .source-citation:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }

        .citation-number {
            font-weight: bold;
            color: #667eea;
            font-size: 1rem;
            min-width: 30px;
        }

        .citation-title {
            flex: 1;
            color: #2d3748;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .citation-relevance {
            padding: 4px 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 50px;
            text-align: center;
        }

        .copy-answer-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .copy-answer-btn:hover {
            background: #38a169;
            transform: scale(1.05);
        }

        /* Enhanced Prediction UI Styles */
        .prediction-dashboard {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .prediction-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2d3748;
        }

        .model-info {
            font-size: 0.85rem;
            color: #718096;
        }

        .status-banner {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-normal {
            background: #c6f6d5;
            color: #22543d;
            border-left: 5px solid #48bb78;
        }

        .status-warning {
            background: #fefcbf;
            color: #744210;
            border-left: 5px solid #ed8936;
        }

        .status-alert {
            background: #fed7d7;
            color: #742a2a;
            border-left: 5px solid #f56565;
        }

        .horizon-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .horizon-tab {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .horizon-tab:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .horizon-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .horizon-content {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 20px;
        }

        .horizon-content.active {
            display: block;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
        }

        .risk-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
        }

        .risk-low {
            background: #c6f6d5;
            color: #22543d;
        }

        .risk-medium {
            background: #fefcbf;
            color: #744210;
        }

        .risk-high {
            background: #fed7d7;
            color: #742a2a;
        }

        .factors-container {
            margin-top: 20px;
        }

        .factors-title {
            font-size: 1rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 15px;
        }

        .factor-bar {
            margin-bottom: 12px;
        }

        .factor-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .factor-progress {
            height: 25px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .factor-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .confidence-meter {
            margin-top: 15px;
        }

        .confidence-bar {
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .confidence-high {
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
        }

        .confidence-medium {
            background: linear-gradient(90deg, #ed8936 0%, #dd6b20 100%);
        }

        .confidence-low {
            background: linear-gradient(90deg, #f56565 0%, #e53e3e 100%);
        }

        .technical-details {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .technical-toggle {
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .technical-toggle:hover {
            text-decoration: underline;
        }

        .technical-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .technical-content.show {
            display: block;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .export-btn {
            padding: 8px 16px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .export-btn:hover {
            background: #3182ce;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI-Powered Predictive Maintenance</h1>
            <p>Intelligent Machine Learning Platform for Predictive Analytics</p>
        </div>

        <div class="health-status">
            <div class="health-indicator" id="healthIndicator"></div>
            <span id="healthStatus">Checking API status...</span>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('upload')">üìä Data Upload</button>
            <button class="tab" onclick="showTab('predict')">üîÆ Predictions</button>
            <button class="tab" onclick="showTab('chat')">üí¨ AI Chat</button>
            <button class="tab" onclick="showTab('alerts')">üö® Alerts</button>
        </div>

        <!-- Data Upload Tab -->
        <div id="upload" class="tab-content active">
            <div class="dashboard">
                <div class="card">
                    <h3>üìÅ Upload Sensor Data</h3>
                    <div class="file-upload" id="fileUpload">
                        <p>üìé Drag & drop CSV file here or click to browse</p>
                        <input type="file" id="csvFile" accept=".csv" style="display: none;">
                    </div>
                    <div class="form-group">
                        <label for="machineId">Machine ID (will be added to CSV):</label>
                        <input type="text" id="machineId" placeholder="e.g., MACHINE_001" value="MACHINE_001">
                    </div>
                    <button class="btn" onclick="uploadData()">Upload & Process Data</button>
                    <div class="loading" id="uploadLoading">
                        <div class="spinner"></div>
                        Processing sensor data...
                    </div>
                    <div id="uploadStatus"></div>
                    <div id="uploadResult"></div>
                </div>

                <div class="card">
                    <h3>üìà Sample Data Generator</h3>
                    <p>Generate sample sensor data for testing</p>
                    <div class="form-group">
                        <label for="sampleRows">Number of rows:</label>
                        <input type="number" id="sampleRows" value="100" min="10" max="1000">
                    </div>
                    <button class="btn" onclick="generateSampleData()">Generate Sample Data</button>
                    <div id="sampleStatus"></div>
                </div>
            </div>
        </div>

        <!-- Predictions Tab -->
        <div id="predict" class="tab-content">
            <div class="dashboard">
                <div class="card">
                    <h3>üîÆ Failure Prediction</h3>
                    <div class="form-group">
                        <label for="predictMachineId">Machine ID:</label>
                        <input type="text" id="predictMachineId" placeholder="e.g., MACHINE_001" value="MACHINE_001">
                    </div>
                    <div class="form-group">
                        <label for="horizonHours">Prediction Horizon (hours):</label>
                        <select id="horizonHours">
                            <option value="24">24 hours</option>
                            <option value="48">48 hours</option>
                            <option value="72">72 hours</option>
                        </select>
                    </div>
                    <button class="btn" onclick="getPrediction()">Get Failure Prediction</button>
                    <div class="loading" id="predictLoading">
                        <div class="spinner"></div>
                        Analyzing machine data...
                    </div>
                    <div id="predictStatus"></div>
                    <div id="predictResult"></div>
                </div>

                <div class="card">
                    <h3>üîç Anomaly Detection</h3>
                    <div class="form-group">
                        <label for="anomalyMachineId">Machine ID:</label>
                        <input type="text" id="anomalyMachineId" placeholder="e.g., MACHINE_001" value="MACHINE_001">
                    </div>
                    <button class="btn" onclick="detectAnomaly()">Detect Anomalies</button>
                    <div class="loading" id="anomalyLoading">
                        <div class="spinner"></div>
                        Detecting anomalies...
                    </div>
                    <div id="anomalyStatus"></div>
                    <div id="anomalyResult"></div>
                </div>
            </div>
        </div>

        <!-- Chat Tab -->
        <div id="chat" class="tab-content">
            <div class="dashboard">
                <div class="card">
                    <h3>üí¨ AI Maintenance Assistant</h3>
                    <div class="form-group">
                        <label for="chatQuestion">Ask a question about maintenance:</label>
                        <textarea id="chatQuestion" rows="4" placeholder="e.g., What are the common causes of bearing failure? How should I maintain my hydraulic system?"></textarea>
                    </div>
                    <button class="btn" onclick="askQuestion()">Ask AI Assistant</button>
                    <div class="loading" id="chatLoading">
                        <div class="spinner"></div>
                        AI is thinking...
                    </div>
                    <div id="chatStatus"></div>
                    <div id="chatResult"></div>
                </div>

                <div class="card">
                    <h3>üí° Quick Questions</h3>
                    <p>Try these sample questions:</p>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="btn" onclick="setQuestion('What are the signs of bearing failure?')" style="background: #48bb78;">Bearing Failure Signs</button>
                        <button class="btn" onclick="setQuestion('How often should I lubricate my equipment?')" style="background: #4299e1;">Lubrication Schedule</button>
                        <button class="btn" onclick="setQuestion('What causes vibration in rotating machinery?')" style="background: #ed8936;">Vibration Analysis</button>
                        <button class="btn" onclick="setQuestion('How to troubleshoot hydraulic system issues?')" style="background: #9f7aea;">Hydraulic Systems</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Tab -->
        <div id="alerts" class="tab-content">
            <div class="dashboard">
                <div class="card">
                    <h3>üö® Active Alerts</h3>
                    <button class="btn" onclick="getAlerts()">Refresh Alerts</button>
                    <div class="loading" id="alertsLoading">
                        <div class="spinner"></div>
                        Loading alerts...
                    </div>
                    <div id="alertsStatus"></div>
                    <div id="alertsResult"></div>
                </div>

                <div class="card">
                    <h3>üìä System Health</h3>
                    <button class="btn" onclick="getHealth()">Check System Health</button>
                    <div id="healthResult"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        const API_KEY = 'dev-CHANGE-ME';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkHealth();
            setupFileUpload();
        });

        // Tab switching
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Health check
        async function checkHealth() {
            try {
                const response = await fetch('http://localhost:8000/healthz');
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('healthStatus').textContent = '‚úÖ API is healthy';
                    document.getElementById('healthIndicator').style.background = '#48bb78';
                } else {
                    throw new Error('API not responding');
                }
            } catch (error) {
                document.getElementById('healthStatus').textContent = '‚ùå API connection failed';
                document.getElementById('healthIndicator').style.background = '#e53e3e';
            }
        }

        // File upload setup
        function setupFileUpload() {
            const fileUpload = document.getElementById('fileUpload');
            const fileInput = document.getElementById('csvFile');

            fileUpload.addEventListener('click', () => fileInput.click());
            fileUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUpload.classList.add('dragover');
            });
            fileUpload.addEventListener('dragleave', () => {
                fileUpload.classList.remove('dragover');
            });
            fileUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUpload.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                }
            });
        }

        // Upload data
        async function uploadData() {
            const fileInput = document.getElementById('csvFile');
            const machineId = document.getElementById('machineId').value;
            
            if (!fileInput.files[0]) {
                showStatus('uploadStatus', 'Please select a CSV file', 'error');
                return;
            }

            showLoading('uploadLoading', true);
            showStatus('uploadStatus', '', '');
            showResult('uploadResult', '');

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch(`${API_BASE}/ingest?api_key=${API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    showStatus('uploadStatus', '‚úÖ Data uploaded successfully!', 'success');
                    showResult('uploadResult', JSON.stringify(data, null, 2));
                } else {
                    let errorMessage = 'Unknown error';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.detail || errorData.message || JSON.stringify(errorData);
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    showStatus('uploadStatus', `‚ùå Upload failed: ${errorMessage}`, 'error');
                }
            } catch (error) {
                showStatus('uploadStatus', `‚ùå Upload failed: ${error.message}`, 'error');
            } finally {
                showLoading('uploadLoading', false);
            }
        }

        // Generate sample data
        async function generateSampleData() {
            const rows = document.getElementById('sampleRows').value;
            const machineId = document.getElementById('machineId').value || 'MACHINE_001';
            showStatus('sampleStatus', 'Generating sample data...', 'info');
            
            // Generate sample CSV data
            let csvContent = 'timestamp,machine_id,sensor,value\n';
            const now = new Date();
            
            for (let i = 0; i < rows; i++) {
                const timestamp = new Date(now.getTime() - (rows - i) * 60000).toISOString();
                const sensors = ['temperature', 'vibration', 'pressure', 'speed'];
                const sensor = sensors[Math.floor(Math.random() * sensors.length)];
                const value = (Math.random() * 100).toFixed(2);
                
                csvContent += `${timestamp},${machineId},${sensor},${value}\n`;
            }
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sample_sensor_data.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showStatus('sampleStatus', '‚úÖ Sample data generated and downloaded!', 'success');
        }

        // Get prediction
        async function getPrediction() {
            const machineId = document.getElementById('predictMachineId').value;
            const horizonHours = document.getElementById('horizonHours').value;
            
            showLoading('predictLoading', true);
            showStatus('predictStatus', '', '');
            document.getElementById('predictResult').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/predict?api_key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        machine_id: machineId,
                        horizon_hours: parseInt(horizonHours),
                        include_anomaly: true,
                        include_factors: true
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showStatus('predictStatus', '‚úÖ Prediction analysis complete!', 'success');
                    renderPredictionDashboard(data, machineId);
                } else {
                    showStatus('predictStatus', `‚ùå Prediction failed: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showStatus('predictStatus', `‚ùå Prediction failed: ${error.message}`, 'error');
            } finally {
                showLoading('predictLoading', false);
            }
        }

        // Render prediction dashboard
        function renderPredictionDashboard(data, machineId) {
            const container = document.getElementById('predictResult');
            const predictions = data.predictions || [data];
            
            // Determine overall status
            const maxFailureProb = Math.max(...predictions.map(p => p.failure_probability || 0));
            const maxAnomalyScore = Math.max(...predictions.map(p => p.anomaly_score || 0));
            
            let statusClass = 'status-normal';
            let statusIcon = 'üü¢';
            let statusText = 'NORMAL - No issues detected';
            
            if (maxFailureProb > 0.7 || maxAnomalyScore > 0.8) {
                statusClass = 'status-alert';
                statusIcon = 'üî¥';
                statusText = 'ALERT - High risk detected';
            } else if (maxFailureProb > 0.3 || maxAnomalyScore > 0.5) {
                statusClass = 'status-warning';
                statusIcon = 'üü°';
                statusText = 'WARNING - Moderate risk detected';
            }
            
            let html = `
                <div class="prediction-dashboard">
                    <div class="prediction-header">
                        <div class="prediction-title">Prediction Dashboard: ${machineId}</div>
                        <div class="model-info">
                            Model: ${data.model_version || 'v1.0.0'} | 
                            Generated: ${new Date().toLocaleString()}
                        </div>
                    </div>
                    
                    <div class="status-banner ${statusClass}">
                        <span style="font-size: 1.5rem;">${statusIcon}</span>
                        <span>${statusText}</span>
                    </div>
            `;
            
            // Add horizon tabs if multiple predictions
            if (predictions.length > 1) {
                html += `<div class="horizon-tabs">`;
                predictions.forEach((pred, idx) => {
                    const horizon = pred.horizon_hours || 24;
                    html += `
                        <div class="horizon-tab ${idx === 0 ? 'active' : ''}" onclick="switchHorizon(${idx})">
                            ${horizon}h Forecast
                        </div>
                    `;
                });
                html += `</div>`;
            }
            
            // Add horizon content
            predictions.forEach((pred, idx) => {
                html += renderHorizonContent(pred, idx, idx === 0);
            });
            
            // Add export buttons
            html += `
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportPrediction('json')">
                        üìÑ Download JSON
                    </button>
                    <button class="export-btn" onclick="exportPrediction('csv')">
                        üìä Download CSV
                    </button>
                </div>
            `;
            
            html += `</div>`;
            container.innerHTML = html;
            
            // Store data for export
            window.predictionData = data;
        }

        // Render individual horizon content
        function renderHorizonContent(pred, index, isActive) {
            const failureProb = (pred.failure_probability || 0) * 100;
            const anomalyScore = (pred.anomaly_score || 0) * 100;
            const confidence = (pred.confidence || 0) * 100;
            
            // Determine risk levels
            let riskClass = 'risk-low';
            let riskText = 'Very Low Risk';
            let riskIcon = 'üü¢';
            
            if (failureProb > 70) {
                riskClass = 'risk-high';
                riskText = 'High Risk';
                riskIcon = 'üî¥';
            } else if (failureProb > 30) {
                riskClass = 'risk-medium';
                riskText = 'Medium Risk';
                riskIcon = 'üü°';
            }
            
            let anomalyClass = 'risk-low';
            let anomalyText = 'Normal';
            
            if (anomalyScore > 80) {
                anomalyClass = 'risk-high';
                anomalyText = 'High Anomaly';
            } else if (anomalyScore > 50) {
                anomalyClass = 'risk-medium';
                anomalyText = 'Moderate Anomaly';
            }
            
            let confClass = confidence > 70 ? 'confidence-high' : confidence > 50 ? 'confidence-medium' : 'confidence-low';
            let confLabel = confidence > 70 ? 'High' : confidence > 50 ? 'Medium' : 'Low';
            
            let html = `
                <div class="horizon-content ${isActive ? 'active' : ''}" id="horizon-${index}">
                    <div class="metric-grid">
                        <div class="metric-card">
                            <div class="metric-label">Failure Probability</div>
                            <div class="metric-value">
                                ${failureProb < 0.01 ? '<0.01' : failureProb.toFixed(2)}%
                            </div>
                            <span class="risk-badge ${riskClass}">${riskIcon} ${riskText}</span>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-label">Anomaly Score</div>
                            <div class="metric-value">${anomalyScore.toFixed(1)}%</div>
                            <span class="risk-badge ${anomalyClass}">${anomalyText}</span>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-label">Confidence Level</div>
                            <div class="metric-value">${confidence.toFixed(0)}%</div>
                            <div class="confidence-meter">
                                <div class="confidence-bar">
                                    <div class="confidence-fill ${confClass}" style="width: ${confidence}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
            `;
            
            // Add top factors if available
            if (pred.top_factors && pred.top_factors.length > 0) {
                html += `
                    <div class="factors-container">
                        <div class="factors-title">üìä Top Contributing Factors</div>
                `;
                
                pred.top_factors.slice(0, 5).forEach(factor => {
                    const featureName = factor.feature.replace(/_/g, ' ').replace(/roll/g, 'avg');
                    const importance = factor.importance * 100;
                    
                    html += `
                        <div class="factor-bar">
                            <div class="factor-label">
                                <span>${featureName}</span>
                                <span>${importance.toFixed(1)}%</span>
                            </div>
                            <div class="factor-progress">
                                <div class="factor-fill" style="width: ${importance}%">
                                    ${importance.toFixed(0)}%
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            // Add technical details
            html += `
                <div class="technical-details">
                    <div class="technical-toggle" onclick="toggleTechnical(${index})">
                        ‚ñº Technical Details
                    </div>
                    <div class="technical-content" id="technical-${index}">
                        <pre>${JSON.stringify(pred, null, 2)}</pre>
                    </div>
                </div>
            `;
            
            html += `</div>`;
            return html;
        }

        // Switch horizon tabs
        function switchHorizon(index) {
            // Update tabs
            document.querySelectorAll('.horizon-tab').forEach((tab, idx) => {
                tab.classList.toggle('active', idx === index);
            });
            
            // Update content
            document.querySelectorAll('.horizon-content').forEach((content, idx) => {
                content.classList.toggle('active', idx === index);
            });
        }

        // Toggle technical details
        function toggleTechnical(index) {
            const content = document.getElementById(`technical-${index}`);
            content.classList.toggle('show');
        }

        // Export prediction data
        function exportPrediction(format) {
            if (!window.predictionData) {
                alert('No prediction data to export');
                return;
            }
            
            const data = window.predictionData;
            let content, filename, type;
            
            if (format === 'json') {
                content = JSON.stringify(data, null, 2);
                filename = `prediction_${new Date().getTime()}.json`;
                type = 'application/json';
            } else if (format === 'csv') {
                // Convert to CSV
                const predictions = data.predictions || [data];
                let csv = 'Horizon,Failure_Probability,Anomaly_Score,Confidence\n';
                predictions.forEach(p => {
                    csv += `${p.horizon_hours || 24},${p.failure_probability},${p.anomaly_score},${p.confidence}\n`;
                });
                content = csv;
                filename = `prediction_${new Date().getTime()}.csv`;
                type = 'text/csv';
            }
            
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            alert(`‚úÖ ${format.toUpperCase()} file downloaded!`);
        }

        // Detect anomaly
        async function detectAnomaly() {
            const machineId = document.getElementById('anomalyMachineId').value;
            
            showLoading('anomalyLoading', true);
            showStatus('anomalyStatus', '', '');
            document.getElementById('anomalyResult').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/predict?api_key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        machine_id: machineId,
                        include_anomaly: true,
                        include_factors: true
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showStatus('anomalyStatus', '‚úÖ Anomaly detection analysis complete!', 'success');
                    renderAnomalyDashboard(data, machineId);
                } else {
                    showStatus('anomalyStatus', `‚ùå Anomaly detection failed: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showStatus('anomalyStatus', `‚ùå Anomaly detection failed: ${error.message}`, 'error');
            } finally {
                showLoading('anomalyLoading', false);
            }
        }

        // Render anomaly detection dashboard
        function renderAnomalyDashboard(data, machineId) {
            const container = document.getElementById('anomalyResult');
            const predictions = data.predictions || [data];
            
            // Get anomaly score (use first prediction or data directly)
            const pred = predictions[0] || data;
            const anomalyScore = (pred.anomaly_score || 0) * 100;
            const failureProb = (pred.failure_probability || 0) * 100;
            const confidence = (pred.confidence || 0) * 100;
            
            // Determine overall status
            let statusClass = 'status-normal';
            let statusIcon = 'üü¢';
            let statusText = 'NORMAL - Equipment operating within expected parameters';
            
            if (anomalyScore > 80) {
                statusClass = 'status-alert';
                statusIcon = 'üî¥';
                statusText = 'HIGH ANOMALY - Immediate investigation required';
            } else if (anomalyScore > 50) {
                statusClass = 'status-warning';
                statusIcon = 'üü°';
                statusText = 'MODERATE ANOMALY - Monitoring recommended';
            }
            
            // Determine anomaly level
            let anomalyClass = 'risk-low';
            let anomalyText = 'Normal';
            let anomalyIcon = 'üü¢';
            let anomalyDescription = 'All sensors are operating within normal ranges';
            
            if (anomalyScore > 80) {
                anomalyClass = 'risk-high';
                anomalyText = 'High Anomaly';
                anomalyIcon = 'üî¥';
                anomalyDescription = 'Significant deviation detected - immediate attention required';
            } else if (anomalyScore > 50) {
                anomalyClass = 'risk-medium';
                anomalyText = 'Moderate Anomaly';
                anomalyIcon = 'üü°';
                anomalyDescription = 'Unusual patterns detected - schedule inspection';
            } else if (anomalyScore > 20) {
                anomalyClass = 'risk-low';
                anomalyText = 'Low Anomaly';
                anomalyIcon = 'üü¢';
                anomalyDescription = 'Minor variations detected - continue monitoring';
            }
            
            let confClass = confidence > 70 ? 'confidence-high' : confidence > 50 ? 'confidence-medium' : 'confidence-low';
            
            let html = `
                <div class="prediction-dashboard">
                    <div class="prediction-header">
                        <div class="prediction-title">üîç Anomaly Detection: ${machineId}</div>
                        <div class="model-info">
                            Model: ${data.model_version || 'Isolation Forest v1.0'} | 
                            Analyzed: ${new Date().toLocaleString()}
                        </div>
                    </div>
                    
                    <div class="status-banner ${statusClass}">
                        <span style="font-size: 1.5rem;">${statusIcon}</span>
                        <span>${statusText}</span>
                    </div>
                    
                    <div class="horizon-content active">
                        <div class="metric-grid">
                            <div class="metric-card" style="border-left-color: ${anomalyScore > 80 ? '#f56565' : anomalyScore > 50 ? '#ed8936' : '#48bb78'};">
                                <div class="metric-label">Anomaly Score</div>
                                <div class="metric-value">${anomalyScore.toFixed(1)}%</div>
                                <span class="risk-badge ${anomalyClass}">${anomalyIcon} ${anomalyText}</span>
                            </div>
                            
                            <div class="metric-card" style="border-left-color: ${failureProb > 70 ? '#f56565' : failureProb > 30 ? '#ed8936' : '#48bb78'};">
                                <div class="metric-label">Failure Risk</div>
                                <div class="metric-value">
                                    ${failureProb < 0.01 ? '<0.01' : failureProb.toFixed(2)}%
                                </div>
                                <span class="risk-badge ${failureProb > 70 ? 'risk-high' : failureProb > 30 ? 'risk-medium' : 'risk-low'}">
                                    ${failureProb > 70 ? 'üî¥' : failureProb > 30 ? 'üü°' : 'üü¢'} 
                                    ${failureProb > 70 ? 'High' : failureProb > 30 ? 'Medium' : 'Low'} Risk
                                </span>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-label">Detection Confidence</div>
                                <div class="metric-value">${confidence.toFixed(0)}%</div>
                                <div class="confidence-meter">
                                    <div class="confidence-bar">
                                        <div class="confidence-fill ${confClass}" style="width: ${confidence}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid ${anomalyScore > 80 ? '#f56565' : anomalyScore > 50 ? '#ed8936' : '#48bb78'};">
                            <div style="font-weight: 600; color: #2d3748; margin-bottom: 8px;">
                                üìã Assessment
                            </div>
                            <div style="color: #4a5568; line-height: 1.6;">
                                ${anomalyDescription}
                            </div>
                        </div>
            `;
            
            // Add anomaly score visualization
            html += `
                <div class="factors-container">
                    <div class="factors-title">üìä Anomaly Score Breakdown</div>
                    <div class="factor-bar">
                        <div class="factor-label">
                            <span>Overall Anomaly Level</span>
                            <span>${anomalyScore.toFixed(1)}%</span>
                        </div>
                        <div class="factor-progress">
                            <div class="factor-fill" style="width: ${anomalyScore}%; background: ${anomalyScore > 80 ? 'linear-gradient(90deg, #f56565 0%, #e53e3e 100%)' : anomalyScore > 50 ? 'linear-gradient(90deg, #ed8936 0%, #dd6b20 100%)' : 'linear-gradient(90deg, #48bb78 0%, #38a169 100%)'};">
                                ${anomalyScore.toFixed(1)}%
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add top contributing factors if available
            if (pred.top_factors && pred.top_factors.length > 0) {
                html += `
                    <div class="factors-container">
                        <div class="factors-title">üîß Sensors Contributing to Anomaly</div>
                `;
                
                pred.top_factors.slice(0, 5).forEach(factor => {
                    const featureName = factor.feature.replace(/_/g, ' ').replace(/roll/g, 'avg').replace(/lag/g, 'prev');
                    const importance = factor.importance * 100;
                    
                    html += `
                        <div class="factor-bar">
                            <div class="factor-label">
                                <span>${featureName}</span>
                                <span>${importance.toFixed(1)}%</span>
                            </div>
                            <div class="factor-progress">
                                <div class="factor-fill" style="width: ${importance}%">
                                    ${importance.toFixed(0)}%
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            // Add recommendations
            html += `
                <div class="factors-container">
                    <div class="factors-title">üí° Recommendations</div>
                    <div style="background: white; padding: 15px; border-radius: 8px;">
            `;
            
            if (anomalyScore > 80) {
                html += `
                    <div style="margin-bottom: 10px; padding: 10px; background: #fed7d7; border-left: 3px solid #f56565; border-radius: 5px;">
                        <strong>üî¥ Immediate Action Required:</strong><br>
                        ‚Ä¢ Stop machine and conduct thorough inspection<br>
                        ‚Ä¢ Check sensors listed above for malfunctions<br>
                        ‚Ä¢ Contact maintenance team immediately
                    </div>
                `;
            } else if (anomalyScore > 50) {
                html += `
                    <div style="margin-bottom: 10px; padding: 10px; background: #fefcbf; border-left: 3px solid #ed8936; border-radius: 5px;">
                        <strong>üü° Monitoring Required:</strong><br>
                        ‚Ä¢ Schedule inspection within 24 hours<br>
                        ‚Ä¢ Increase monitoring frequency<br>
                        ‚Ä¢ Review sensor data for patterns
                    </div>
                `;
            } else {
                html += `
                    <div style="margin-bottom: 10px; padding: 10px; background: #c6f6d5; border-left: 3px solid #48bb78; border-radius: 5px;">
                        <strong>üü¢ Preventive Measures:</strong><br>
                        ‚Ä¢ Continue regular monitoring schedule<br>
                        ‚Ä¢ Maintain routine maintenance procedures<br>
                        ‚Ä¢ Document any minor variations for trend analysis
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
            `;
            
            // Add technical details
            html += `
                <div class="technical-details">
                    <div class="technical-toggle" onclick="toggleTechnical(0)">
                        ‚ñº Technical Details & Raw Data
                    </div>
                    <div class="technical-content" id="technical-0">
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                </div>
            `;
            
            // Add export buttons
            html += `
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportAnomaly('json')">
                        üìÑ Download JSON Report
                    </button>
                    <button class="export-btn" onclick="exportAnomaly('csv')">
                        üìä Download CSV Report
                    </button>
                </div>
            `;
            
            html += `</div></div>`;
            container.innerHTML = html;
            
            // Store data for export
            window.anomalyData = data;
        }

        // Export anomaly data
        function exportAnomaly(format) {
            if (!window.anomalyData) {
                alert('No anomaly data to export');
                return;
            }
            
            const data = window.anomalyData;
            const pred = (data.predictions && data.predictions[0]) || data;
            let content, filename, type;
            
            if (format === 'json') {
                content = JSON.stringify(data, null, 2);
                filename = `anomaly_detection_${new Date().getTime()}.json`;
                type = 'application/json';
            } else if (format === 'csv') {
                // Convert to CSV
                let csv = 'Timestamp,Machine_ID,Anomaly_Score,Failure_Probability,Confidence,Status\n';
                const anomalyScore = (pred.anomaly_score || 0) * 100;
                const status = anomalyScore > 80 ? 'High Anomaly' : anomalyScore > 50 ? 'Moderate Anomaly' : 'Normal';
                csv += `${new Date().toISOString()},${pred.machine_id || 'Unknown'},${pred.anomaly_score},${pred.failure_probability},${pred.confidence},${status}\n`;
                content = csv;
                filename = `anomaly_detection_${new Date().getTime()}.csv`;
                type = 'text/csv';
            }
            
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            alert(`‚úÖ ${format.toUpperCase()} report downloaded!`);
        }

        // Ask question
        async function askQuestion() {
            const question = document.getElementById('chatQuestion').value.trim();
            
            if (!question) {
                showStatus('chatStatus', 'Please enter a question', 'error');
                return;
            }
            
            showLoading('chatLoading', true);
            showStatus('chatStatus', '', '');
            document.getElementById('chatResult').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/chat?api_key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: question,
                        include_sources: true,
                        max_results: 5
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showStatus('chatStatus', '‚úÖ Answer generated successfully!', 'success');
                    renderChatAnswer(data, question);
                } else {
                    showStatus('chatStatus', `‚ùå Chat failed: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showStatus('chatStatus', `‚ùå Chat failed: ${error.message}`, 'error');
            } finally {
                showLoading('chatLoading', false);
            }
        }

        // Render user-friendly chat answer
        function renderChatAnswer(data, question) {
            const container = document.getElementById('chatResult');
            
            // Determine confidence level
            const confidence = data.confidence || 0;
            let confidenceClass = 'confidence-low';
            let confidenceEmoji = '‚ö†Ô∏è';
            if (confidence >= 0.7) {
                confidenceClass = 'confidence-high';
                confidenceEmoji = '‚úÖ';
            } else if (confidence >= 0.5) {
                confidenceClass = 'confidence-medium';
                confidenceEmoji = '‚ö°';
            }
            
            let html = `
                <div class="chat-answer-container">
                    <div class="chat-answer-header">
                        <div class="chat-answer-title">
                            <span>üõ†Ô∏è AI Assistant Answer</span>
                        </div>
                        <div>
                            <span class="confidence-badge ${confidenceClass}">
                                ${confidenceEmoji} ${Math.round(confidence * 100)}% Confidence
                            </span>
                            <button class="copy-answer-btn" onclick="copyAnswer('${escapeHtml(data.answer)}')">
                                üìã Copy Answer
                            </button>
                        </div>
                    </div>
                    
                    <div class="chat-answer-text">
                        ${escapeHtml(data.answer)}
                    </div>
            `;
            
            // Add sources if available (show top 3 as compact citations)
            if (data.sources && data.sources.length > 0) {
                const topSources = data.sources.slice(0, 3); // Only top 3
                html += `
                    <div class="chat-sources-container">
                        <div class="chat-sources-header">
                            üìö Sources Referenced
                        </div>
                        <div class="source-citations">
                `;
                
                topSources.forEach((source, index) => {
                    const relevance = Math.round(source.relevance_score * 100);
                    
                    html += `
                        <div class="source-citation">
                            <span class="citation-number">[${index + 1}]</span>
                            <span class="citation-title">${escapeHtml(source.title)}</span>
                            <span class="citation-relevance">${relevance}%</span>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            html += `</div>`;
            container.innerHTML = html;
        }

        // Copy answer to clipboard
        function copyAnswer(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Answer copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Set question
        function setQuestion(question) {
            document.getElementById('chatQuestion').value = question;
        }

        // Get alerts
        async function getAlerts() {
            showLoading('alertsLoading', true);
            showStatus('alertsStatus', '', '');
            showResult('alertsResult', '');

            try {
                const response = await fetch(`${API_BASE}/alerts?api_key=${API_KEY}`);
                const data = await response.json();
                
                if (response.ok) {
                    showStatus('alertsStatus', `‚úÖ Found ${data.length} alerts`, 'success');
                    showResult('alertsResult', JSON.stringify(data, null, 2));
                } else {
                    showStatus('alertsStatus', `‚ùå Failed to get alerts: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showStatus('alertsStatus', `‚ùå Failed to get alerts: ${error.message}`, 'error');
            } finally {
                showLoading('alertsLoading', false);
            }
        }

        // Get health
        async function getHealth() {
            try {
                const response = await fetch('http://localhost:8000/healthz');
                const data = await response.json();
                
                if (response.ok) {
                    showResult('healthResult', JSON.stringify(data, null, 2));
                } else {
                    showResult('healthResult', `Health check failed: ${data.detail || 'Unknown error'}`);
                }
            } catch (error) {
                showResult('healthResult', `Health check failed: ${error.message}`);
            }
        }

        // Utility functions
        function showLoading(elementId, show) {
            document.getElementById(elementId).style.display = show ? 'block' : 'none';
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            if (content) {
                element.innerHTML = `<pre>${content}</pre>`;
            } else {
                element.innerHTML = '';
            }
        }
    </script>
</body>
</html>
